"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const health_check_1 = require("../lambda/health-check");
const client_dynamodb_1 = require("@aws-sdk/client-dynamodb");
const client_s3_1 = require("@aws-sdk/client-s3");
const client_sqs_1 = require("@aws-sdk/client-sqs");
const client_cloudwatch_1 = require("@aws-sdk/client-cloudwatch");
const client_sns_1 = require("@aws-sdk/client-sns");
// Mock AWS SDK clients
jest.mock('@aws-sdk/client-dynamodb');
jest.mock('@aws-sdk/client-s3');
jest.mock('@aws-sdk/client-sqs');
jest.mock('@aws-sdk/client-cloudwatch');
jest.mock('@aws-sdk/client-sns');
describe('Health Check Handler', () => {
    let mockDynamoSend;
    let mockS3Send;
    let mockSQSSend;
    let mockCloudWatchSend;
    let mockSNSSend;
    const mockEvent = {
        id: 'test-event-id',
        'detail-type': 'Scheduled Event',
        source: 'aws.events',
        account: '123456789012',
        time: '2023-01-01T00:00:00Z',
        region: 'us-east-1',
        detail: {},
        version: '0',
        resources: ['arn:aws:events:us-east-1:123456789012:rule/test-rule'],
    };
    const mockContext = {
        callbackWaitsForEmptyEventLoop: false,
        functionName: 'health-check',
        functionVersion: '1',
        invokedFunctionArn: 'arn:aws:lambda:us-east-1:123456789012:function:health-check',
        memoryLimitInMB: '128',
        awsRequestId: 'test-request-id',
        logGroupName: '/aws/lambda/health-check',
        logStreamName: '2023/01/01/[$LATEST]test',
        getRemainingTimeInMillis: () => 30000,
        done: jest.fn(),
        fail: jest.fn(),
        succeed: jest.fn(),
    };
    beforeEach(() => {
        jest.clearAllMocks();
        mockDynamoSend = jest.fn();
        mockS3Send = jest.fn();
        mockSQSSend = jest.fn();
        mockCloudWatchSend = jest.fn();
        mockSNSSend = jest.fn();
        client_dynamodb_1.DynamoDBClient.mockImplementation(() => ({
            send: mockDynamoSend,
        }));
        client_s3_1.S3Client.mockImplementation(() => ({
            send: mockS3Send,
        }));
        client_sqs_1.SQSClient.mockImplementation(() => ({
            send: mockSQSSend,
        }));
        client_cloudwatch_1.CloudWatchClient.mockImplementation(() => ({
            send: mockCloudWatchSend,
        }));
        client_sns_1.SNSClient.mockImplementation(() => ({
            send: mockSNSSend,
        }));
        // Set up environment variables
        process.env.CONTENT_TABLE_NAME = 'test-content-table';
        process.env.USER_TABLE_NAME = 'test-user-table';
        process.env.AGENT_MESSAGES_TABLE_NAME = 'test-agent-messages-table';
        process.env.AUDIO_BUCKET_NAME = 'test-audio-bucket';
        process.env.IMAGE_BUCKET_NAME = 'test-image-bucket';
        process.env.AGENT_QUEUE_URL = 'https://sqs.us-east-1.amazonaws.com/123456789012/test-agent-queue';
        process.env.EVENT_BUS_NAME = 'test-event-bus';
        process.env.API_GATEWAY_URL = 'https://api.example.com';
        process.env.AWS_REGION = 'us-east-1';
    });
    afterEach(() => {
        // Clean up environment variables
        delete process.env.CONTENT_TABLE_NAME;
        delete process.env.USER_TABLE_NAME;
        delete process.env.AGENT_MESSAGES_TABLE_NAME;
        delete process.env.AUDIO_BUCKET_NAME;
        delete process.env.IMAGE_BUCKET_NAME;
        delete process.env.AGENT_QUEUE_URL;
        delete process.env.EVENT_BUS_NAME;
        delete process.env.API_GATEWAY_URL;
        delete process.env.ALERT_TOPIC_ARN;
    });
    it('should complete health check successfully when all services are healthy', async () => {
        // Mock successful responses
        mockDynamoSend.mockResolvedValue({
            Table: {
                TableStatus: 'ACTIVE',
                ItemCount: 100,
            },
        });
        mockS3Send.mockResolvedValue({});
        mockSQSSend.mockResolvedValue({
            Attributes: {
                ApproximateNumberOfMessages: '5',
                ApproximateNumberOfMessagesNotVisible: '2',
            },
        });
        mockCloudWatchSend.mockResolvedValue({});
        const consoleSpy = jest.spyOn(console, 'log').mockImplementation();
        await (0, health_check_1.handler)(mockEvent, mockContext);
        expect(mockDynamoSend).toHaveBeenCalled();
        expect(mockS3Send).toHaveBeenCalled();
        expect(mockSQSSend).toHaveBeenCalled();
        expect(mockCloudWatchSend).toHaveBeenCalled();
        expect(mockSNSSend).not.toHaveBeenCalled(); // No alerts for healthy system
        expect(consoleSpy).toHaveBeenCalledWith('Starting system health check...');
        expect(consoleSpy).toHaveBeenCalledWith('Health check completed:', expect.stringContaining('"overallStatus":"healthy"'));
        consoleSpy.mockRestore();
    });
    it('should detect unhealthy DynamoDB and send alert', async () => {
        process.env.ALERT_TOPIC_ARN = 'arn:aws:sns:us-east-1:123456789012:test-alerts';
        // Mock DynamoDB failure
        mockDynamoSend.mockRejectedValue(new Error('DynamoDB connection failed'));
        // Mock other services as healthy
        mockS3Send.mockResolvedValue({});
        mockSQSSend.mockResolvedValue({
            Attributes: {
                ApproximateNumberOfMessages: '0',
                ApproximateNumberOfMessagesNotVisible: '0',
            },
        });
        mockCloudWatchSend.mockResolvedValue({});
        mockSNSSend.mockResolvedValue({});
        const consoleSpy = jest.spyOn(console, 'log').mockImplementation();
        await (0, health_check_1.handler)(mockEvent, mockContext);
        expect(mockSNSSend).toHaveBeenCalled(); // Alert should be sent
        expect(consoleSpy).toHaveBeenCalledWith('Health check completed:', expect.stringContaining('"overallStatus":"unhealthy"'));
        consoleSpy.mockRestore();
    });
    it('should detect degraded SQS with message backlog', async () => {
        // Mock successful responses but with high message count
        mockDynamoSend.mockResolvedValue({
            Table: {
                TableStatus: 'ACTIVE',
                ItemCount: 100,
            },
        });
        mockS3Send.mockResolvedValue({});
        mockSQSSend.mockResolvedValue({
            Attributes: {
                ApproximateNumberOfMessages: '150',
                ApproximateNumberOfMessagesNotVisible: '50',
            },
        });
        mockCloudWatchSend.mockResolvedValue({});
        const consoleSpy = jest.spyOn(console, 'log').mockImplementation();
        await (0, health_check_1.handler)(mockEvent, mockContext);
        expect(mockCloudWatchSend).toHaveBeenCalled();
        expect(consoleSpy).toHaveBeenCalledWith('Health check completed:', expect.stringContaining('"overallStatus":"degraded"'));
        consoleSpy.mockRestore();
    });
    it('should handle S3 access errors', async () => {
        // Mock DynamoDB as healthy
        mockDynamoSend.mockResolvedValue({
            Table: {
                TableStatus: 'ACTIVE',
                ItemCount: 100,
            },
        });
        // Mock S3 failure
        mockS3Send.mockRejectedValue(new Error('Access Denied'));
        // Mock other services as healthy
        mockSQSSend.mockResolvedValue({
            Attributes: {
                ApproximateNumberOfMessages: '0',
                ApproximateNumberOfMessagesNotVisible: '0',
            },
        });
        mockCloudWatchSend.mockResolvedValue({});
        const consoleSpy = jest.spyOn(console, 'log').mockImplementation();
        await (0, health_check_1.handler)(mockEvent, mockContext);
        expect(consoleSpy).toHaveBeenCalledWith('Health check completed:', expect.stringContaining('"overallStatus":"unhealthy"'));
        consoleSpy.mockRestore();
    });
    it('should send critical alert when health check system fails', async () => {
        process.env.ALERT_TOPIC_ARN = 'arn:aws:sns:us-east-1:123456789012:test-alerts';
        // Mock all services to throw errors
        mockDynamoSend.mockRejectedValue(new Error('System failure'));
        mockS3Send.mockRejectedValue(new Error('System failure'));
        mockSQSSend.mockRejectedValue(new Error('System failure'));
        mockCloudWatchSend.mockRejectedValue(new Error('CloudWatch failure'));
        mockSNSSend.mockResolvedValue({});
        const consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation();
        await (0, health_check_1.handler)(mockEvent, mockContext);
        expect(mockSNSSend).toHaveBeenCalledWith(expect.objectContaining({
            TopicArn: 'arn:aws:sns:us-east-1:123456789012:test-alerts',
            Subject: 'CRITICAL: Health Check System Failure',
        }));
        consoleErrorSpy.mockRestore();
    });
    it('should handle missing environment variables gracefully', async () => {
        // Remove some environment variables
        delete process.env.CONTENT_TABLE_NAME;
        delete process.env.AUDIO_BUCKET_NAME;
        mockCloudWatchSend.mockResolvedValue({});
        const consoleSpy = jest.spyOn(console, 'log').mockImplementation();
        await (0, health_check_1.handler)(mockEvent, mockContext);
        // Should still complete but with fewer checks
        expect(consoleSpy).toHaveBeenCalledWith('Starting system health check...');
        consoleSpy.mockRestore();
    });
    it('should not send alerts when alert topic is not configured', async () => {
        // Don't set ALERT_TOPIC_ARN
        // Mock DynamoDB failure
        mockDynamoSend.mockRejectedValue(new Error('DynamoDB connection failed'));
        mockS3Send.mockResolvedValue({});
        mockSQSSend.mockResolvedValue({
            Attributes: {
                ApproximateNumberOfMessages: '0',
                ApproximateNumberOfMessagesNotVisible: '0',
            },
        });
        mockCloudWatchSend.mockResolvedValue({});
        const consoleWarnSpy = jest.spyOn(console, 'warn').mockImplementation();
        const consoleSpy = jest.spyOn(console, 'log').mockImplementation();
        await (0, health_check_1.handler)(mockEvent, mockContext);
        expect(mockSNSSend).not.toHaveBeenCalled();
        expect(consoleWarnSpy).toHaveBeenCalledWith('Alert topic ARN not configured, skipping health alert');
        consoleWarnSpy.mockRestore();
        consoleSpy.mockRestore();
    });
    it('should include service response times in metrics', async () => {
        // Mock successful responses with some delay
        mockDynamoSend.mockImplementation(() => new Promise(resolve => setTimeout(() => resolve({
            Table: { TableStatus: 'ACTIVE', ItemCount: 100 }
        }), 100)));
        mockS3Send.mockResolvedValue({});
        mockSQSSend.mockResolvedValue({
            Attributes: {
                ApproximateNumberOfMessages: '0',
                ApproximateNumberOfMessagesNotVisible: '0',
            },
        });
        mockCloudWatchSend.mockResolvedValue({});
        const consoleSpy = jest.spyOn(console, 'log').mockImplementation();
        await (0, health_check_1.handler)(mockEvent, mockContext);
        // Verify that CloudWatch metrics include response times
        expect(mockCloudWatchSend).toHaveBeenCalledWith(expect.objectContaining({
            Namespace: 'AutomatedBlogPoster/HealthCheck',
            MetricData: expect.arrayContaining([
                expect.objectContaining({
                    MetricName: 'ServiceResponseTime',
                    Dimensions: expect.arrayContaining([
                        expect.objectContaining({
                            Name: 'Service',
                            Value: expect.any(String),
                        }),
                    ]),
                }),
            ]),
        }));
        consoleSpy.mockRestore();
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVhbHRoLWNoZWNrLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJoZWFsdGgtY2hlY2sudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHlEQUFpRDtBQUVqRCw4REFBMEQ7QUFDMUQsa0RBQThDO0FBQzlDLG9EQUFnRDtBQUNoRCxrRUFBOEQ7QUFDOUQsb0RBQWdEO0FBRWhELHVCQUF1QjtBQUN2QixJQUFJLENBQUMsSUFBSSxDQUFDLDBCQUEwQixDQUFDLENBQUM7QUFDdEMsSUFBSSxDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO0FBQ2hDLElBQUksQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsQ0FBQztBQUNqQyxJQUFJLENBQUMsSUFBSSxDQUFDLDRCQUE0QixDQUFDLENBQUM7QUFDeEMsSUFBSSxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBRWpDLFFBQVEsQ0FBQyxzQkFBc0IsRUFBRSxHQUFHLEVBQUU7SUFDcEMsSUFBSSxjQUF5QixDQUFDO0lBQzlCLElBQUksVUFBcUIsQ0FBQztJQUMxQixJQUFJLFdBQXNCLENBQUM7SUFDM0IsSUFBSSxrQkFBNkIsQ0FBQztJQUNsQyxJQUFJLFdBQXNCLENBQUM7SUFFM0IsTUFBTSxTQUFTLEdBQW1CO1FBQ2hDLEVBQUUsRUFBRSxlQUFlO1FBQ25CLGFBQWEsRUFBRSxpQkFBaUI7UUFDaEMsTUFBTSxFQUFFLFlBQVk7UUFDcEIsT0FBTyxFQUFFLGNBQWM7UUFDdkIsSUFBSSxFQUFFLHNCQUFzQjtRQUM1QixNQUFNLEVBQUUsV0FBVztRQUNuQixNQUFNLEVBQUUsRUFBRTtRQUNWLE9BQU8sRUFBRSxHQUFHO1FBQ1osU0FBUyxFQUFFLENBQUMsc0RBQXNELENBQUM7S0FDcEUsQ0FBQztJQUVGLE1BQU0sV0FBVyxHQUFZO1FBQzNCLDhCQUE4QixFQUFFLEtBQUs7UUFDckMsWUFBWSxFQUFFLGNBQWM7UUFDNUIsZUFBZSxFQUFFLEdBQUc7UUFDcEIs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LENBQUMsQ0FBQyxDQUNWLENBQUM7UUFFRixVQUFVLENBQUMsaUJBQWlCLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDakMsV0FBVyxDQUFDLGlCQUFpQixDQUFDO1lBQzVCLFVBQVUsRUFBRTtnQkFDViwyQkFBMkIsRUFBRSxHQUFHO2dCQUNoQyxxQ0FBcUMsRUFBRSxHQUFHO2FBQzNDO1NBQ0YsQ0FBQyxDQUFDO1FBRUgsa0JBQWtCLENBQUMsaUJBQWlCLENBQUMsRUFBRSxDQUFDLENBQUM7UUFFekMsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztRQUVuRSxNQUFNLElBQUEsc0JBQU8sRUFBQyxTQUFTLEVBQUUsV0FBVyxDQUFDLENBQUM7UUFFdEMsd0RBQXdEO1FBQ3hELE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLG9CQUFvQixDQUM3QyxNQUFNLENBQUMsZ0JBQWdCLENBQUM7WUFDdEIsU0FBUyxFQUFFLGlDQUFpQztZQUM1QyxVQUFVLEVBQUUsTUFBTSxDQUFDLGVBQWUsQ0FBQztnQkFDakMsTUFBTSxDQUFDLGdCQUFnQixDQUFDO29CQUN0QixVQUFVLEVBQUUscUJBQXFCO29CQUNqQyxVQUFVLEVBQUUsTUFBTSxDQUFDLGVBQWUsQ0FBQzt3QkFDakMsTUFBTSxDQUFDLGdCQUFnQixDQUFDOzRCQUN0QixJQUFJLEVBQUUsU0FBUzs0QkFDZixLQUFLLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUM7eUJBQzFCLENBQUM7cUJBQ0gsQ0FBQztpQkFDSCxDQUFDO2FBQ0gsQ0FBQztTQUNILENBQUMsQ0FDSCxDQUFDO1FBRUYsVUFBVSxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQzNCLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBoYW5kbGVyIH0gZnJvbSAnLi4vbGFtYmRhL2hlYWx0aC1jaGVjayc7XHJcbmltcG9ydCB7IFNjaGVkdWxlZEV2ZW50LCBDb250ZXh0IH0gZnJvbSAnYXdzLWxhbWJkYSc7XHJcbmltcG9ydCB7IER5bmFtb0RCQ2xpZW50IH0gZnJvbSAnQGF3cy1zZGsvY2xpZW50LWR5bmFtb2RiJztcclxuaW1wb3J0IHsgUzNDbGllbnQgfSBmcm9tICdAYXdzLXNkay9jbGllbnQtczMnO1xyXG5pbXBvcnQgeyBTUVNDbGllbnQgfSBmcm9tICdAYXdzLXNkay9jbGllbnQtc3FzJztcclxuaW1wb3J0IHsgQ2xvdWRXYXRjaENsaWVudCB9IGZyb20gJ0Bhd3Mtc2RrL2NsaWVudC1jbG91ZHdhdGNoJztcclxuaW1wb3J0IHsgU05TQ2xpZW50IH0gZnJvbSAnQGF3cy1zZGsvY2xpZW50LXNucyc7XHJcblxyXG4vLyBNb2NrIEFXUyBTREsgY2xpZW50c1xyXG5qZXN0Lm1vY2soJ0Bhd3Mtc2RrL2NsaWVudC1keW5hbW9kYicpO1xyXG5qZXN0Lm1vY2soJ0Bhd3Mtc2RrL2NsaWVudC1zMycpO1xyXG5qZXN0Lm1vY2soJ0Bhd3Mtc2RrL2NsaWVudC1zcXMnKTtcclxuamVzdC5tb2NrKCdAYXdzLXNkay9jbGllbnQtY2xvdWR3YXRjaCcpO1xyXG5qZXN0Lm1vY2soJ0Bhd3Mtc2RrL2NsaWVudC1zbnMnKTtcclxuXHJcbmRlc2NyaWJlKCdIZWFsdGggQ2hlY2sgSGFuZGxlcicsICgpID0+IHtcclxuICBsZXQgbW9ja0R5bmFtb1NlbmQ6IGplc3QuTW9jaztcclxuICBsZXQgbW9ja1MzU2VuZDogamVzdC5Nb2NrO1xyXG4gIGxldCBtb2NrU1FTU2VuZDogamVzdC5Nb2NrO1xyXG4gIGxldCBtb2NrQ2xvdWRXYXRjaFNlbmQ6IGplc3QuTW9jaztcclxuICBsZXQgbW9ja1NOU1NlbmQ6IGplc3QuTW9jaztcclxuXHJcbiAgY29uc3QgbW9ja0V2ZW50OiBTY2hlZHVsZWRFdmVudCA9IHtcclxuICAgIGlkOiAndGVzdC1ldmVudC1pZCcsXHJcbiAgICAnZGV0YWlsLXR5cGUnOiAnU2NoZWR1bGVkIEV2ZW50JyxcclxuICAgIHNvdXJjZTogJ2F3cy5ldmVudHMnLFxyXG4gICAgYWNjb3VudDogJzEyMzQ1Njc4OTAxMicsXHJcbiAgICB0aW1lOiAnMjAyMy0wMS0wMVQwMDowMDowMFonLFxyXG4gICAgcmVnaW9uOiAndXMtZWFzdC0xJyxcclxuICAgIGRldGFpbDoge30sXHJcbiAgICB2ZXJzaW9uOiAnMCcsXHJcbiAgICByZXNvdXJjZXM6IFsnYXJuOmF3czpldmVudHM6dXMtZWFzdC0xOjEyMzQ1Njc4OTAxMjpydWxlL3Rlc3QtcnVsZSddLFxyXG4gIH07XHJcblxyXG4gIGNvbnN0IG1vY2tDb250ZXh0OiBDb250ZXh0ID0ge1xyXG4gICAgY2FsbGJhY2tXYWl0c0ZvckVtcHR5RXZlbnRMb29wOiBmYWxzZSxcclxuICAgIGZ1bmN0aW9uTmFtZTogJ2hlYWx0aC1jaGVjaycsXHJcbiAgICBmdW5jdGlvblZlcnNpb246ICcxJyxcclxuICAgIGludm9rZWRGdW5jdGlvbkFybjogJ2Fybjphd3M6bGFtYmRhOnVzLWVhc3QtMToxMjM0NTY3ODkwMTI6ZnVuY3Rpb246aGVhbHRoLWNoZWNrJyxcclxuICAgIG1lbW9yeUxpbWl0SW5NQjogJzEyOCcsXHJcbiAgICBhd3NSZXF1ZXN0SWQ6ICd0ZXN0LXJlcXVlc3QtaWQnLFxyXG4gICAgbG9nR3JvdXBOYW1lOiAnL2F3cy9sYW1iZGEvaGVhbHRoLWNoZWNrJyxcclxuICAgIGxvZ1N0cmVhbU5hbWU6ICcyMDIzLzAxLzAxL1skTEFURVNUXXRlc3QnLFxyXG4gICAgZ2V0UmVtYWluaW5nVGltZUluTWlsbGlzOiAoKSA9PiAzMDAwMCxcclxuICAgIGRvbmU6IGplc3QuZm4oKSxcclxuICAgIGZhaWw6IGplc3QuZm4oKSxcclxuICAgIHN1Y2NlZWQ6IGplc3QuZm4oKSxcclxuICB9O1xyXG5cclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gICAgXHJcbiAgICBtb2NrRHluYW1vU2VuZCA9IGplc3QuZm4oKTtcclxuICAgIG1vY2tTM1NlbmQgPSBqZXN0LmZuKCk7XHJcbiAgICBtb2NrU1FTU2VuZCA9IGplc3QuZm4oKTtcclxuICAgIG1vY2tDbG91ZFdhdGNoU2VuZCA9IGplc3QuZm4oKTtcclxuICAgIG1vY2tTTlNTZW5kID0gamVzdC5mbigpO1xyXG4gICAgXHJcbiAgICAoRHluYW1vREJDbGllbnQgYXMgamVzdC5Nb2NrKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcclxuICAgICAgc2VuZDogbW9ja0R5bmFtb1NlbmQsXHJcbiAgICB9KSk7XHJcbiAgICBcclxuICAgIChTM0NsaWVudCBhcyBqZXN0Lk1vY2spLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xyXG4gICAgICBzZW5kOiBtb2NrUzNTZW5kLFxyXG4gICAgfSkpO1xyXG4gICAgXHJcbiAgICAoU1FTQ2xpZW50IGFzIGplc3QuTW9jaykubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XHJcbiAgICAgIHNlbmQ6IG1vY2tTUVNTZW5kLFxyXG4gICAgfSkpO1xyXG4gICAgXHJcbiAgICAoQ2xvdWRXYXRjaENsaWVudCBhcyBqZXN0Lk1vY2spLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xyXG4gICAgICBzZW5kOiBtb2NrQ2xvdWRXYXRjaFNlbmQsXHJcbiAgICB9KSk7XHJcbiAgICBcclxuICAgIChTTlNDbGllbnQgYXMgamVzdC5Nb2NrKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcclxuICAgICAgc2VuZDogbW9ja1NOU1NlbmQsXHJcbiAgICB9KSk7XHJcblxyXG4gICAgLy8gU2V0IHVwIGVudmlyb25tZW50IHZhcmlhYmxlc1xyXG4gICAgcHJvY2Vzcy5lbnYuQ09OVEVOVF9UQUJMRV9OQU1FID0gJ3Rlc3QtY29udGVudC10YWJsZSc7XHJcbiAgICBwcm9jZXNzLmVudi5VU0VSX1RBQkxFX05BTUUgPSAndGVzdC11c2VyLXRhYmxlJztcclxuICAgIHByb2Nlc3MuZW52LkFHRU5UX01FU1NBR0VTX1RBQkxFX05BTUUgPSAndGVzdC1hZ2VudC1tZXNzYWdlcy10YWJsZSc7XHJcbiAgICBwcm9jZXNzLmVudi5BVURJT19CVUNLRVRfTkFNRSA9ICd0ZXN0LWF1ZGlvLWJ1Y2tldCc7XHJcbiAgICBwcm9jZXNzLmVudi5JTUFHRV9CVUNLRVRfTkFNRSA9ICd0ZXN0LWltYWdlLWJ1Y2tldCc7XHJcbiAgICBwcm9jZXNzLmVudi5BR0VOVF9RVUVVRV9VUkwgPSAnaHR0cHM6Ly9zcXMudXMtZWFzdC0xLmFtYXpvbmF3cy5jb20vMTIzNDU2Nzg5MDEyL3Rlc3QtYWdlbnQtcXVldWUnO1xyXG4gICAgcHJvY2Vzcy5lbnYuRVZFTlRfQlVTX05BTUUgPSAndGVzdC1ldmVudC1idXMnO1xyXG4gICAgcHJvY2Vzcy5lbnYuQVBJX0dBVEVXQVlfVVJMID0gJ2h0dHBzOi8vYXBpLmV4YW1wbGUuY29tJztcclxuICAgIHByb2Nlc3MuZW52LkFXU19SRUdJT04gPSAndXMtZWFzdC0xJztcclxuICB9KTtcclxuXHJcbiAgYWZ0ZXJFYWNoKCgpID0+IHtcclxuICAgIC8vIENsZWFuIHVwIGVudmlyb25tZW50IHZhcmlhYmxlc1xyXG4gICAgZGVsZXRlIHByb2Nlc3MuZW52LkNPTlRFTlRfVEFCTEVfTkFNRTtcclxuICAgIGRlbGV0ZSBwcm9jZXNzLmVudi5VU0VSX1RBQkxFX05BTUU7XHJcbiAgICBkZWxldGUgcHJvY2Vzcy5lbnYuQUdFTlRfTUVTU0FHRVNfVEFCTEVfTkFNRTtcclxuICAgIGRlbGV0ZSBwcm9jZXNzLmVudi5BVURJT19CVUNLRVRfTkFNRTtcclxuICAgIGRlbGV0ZSBwcm9jZXNzLmVudi5JTUFHRV9CVUNLRVRfTkFNRTtcclxuICAgIGRlbGV0ZSBwcm9jZXNzLmVudi5BR0VOVF9RVUVVRV9VUkw7XHJcbiAgICBkZWxldGUgcHJvY2Vzcy5lbnYuRVZFTlRfQlVTX05BTUU7XHJcbiAgICBkZWxldGUgcHJvY2Vzcy5lbnYuQVBJX0dBVEVXQVlfVVJMO1xyXG4gICAgZGVsZXRlIHByb2Nlc3MuZW52LkFMRVJUX1RPUElDX0FSTjtcclxuICB9KTtcclxuXHJcbiAgaXQoJ3Nob3VsZCBjb21wbGV0ZSBoZWFsdGggY2hlY2sgc3VjY2Vzc2Z1bGx5IHdoZW4gYWxsIHNlcnZpY2VzIGFyZSBoZWFsdGh5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgLy8gTW9jayBzdWNjZXNzZnVsIHJlc3BvbnNlc1xyXG4gICAgbW9ja0R5bmFtb1NlbmQubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICBUYWJsZToge1xyXG4gICAgICAgIFRhYmxlU3RhdHVzOiAnQUNUSVZFJyxcclxuICAgICAgICBJdGVtQ291bnQ6IDEwMCxcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG5cclxuICAgIG1vY2tTM1NlbmQubW9ja1Jlc29sdmVkVmFsdWUoe30pO1xyXG5cclxuICAgIG1vY2tTUVNTZW5kLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgQXR0cmlidXRlczoge1xyXG4gICAgICAgIEFwcHJveGltYXRlTnVtYmVyT2ZNZXNzYWdlczogJzUnLFxyXG4gICAgICAgIEFwcHJveGltYXRlTnVtYmVyT2ZNZXNzYWdlc05vdFZpc2libGU6ICcyJyxcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG5cclxuICAgIG1vY2tDbG91ZFdhdGNoU2VuZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSk7XHJcblxyXG4gICAgY29uc3QgY29uc29sZVNweSA9IGplc3Quc3B5T24oY29uc29sZSwgJ2xvZycpLm1vY2tJbXBsZW1lbnRhdGlvbigpO1xyXG5cclxuICAgIGF3YWl0IGhhbmRsZXIobW9ja0V2ZW50LCBtb2NrQ29udGV4dCk7XHJcblxyXG4gICAgZXhwZWN0KG1vY2tEeW5hbW9TZW5kKS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICBleHBlY3QobW9ja1MzU2VuZCkudG9IYXZlQmVlbkNhbGxlZCgpO1xyXG4gICAgZXhwZWN0KG1vY2tTUVNTZW5kKS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICBleHBlY3QobW9ja0Nsb3VkV2F0Y2hTZW5kKS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICBleHBlY3QobW9ja1NOU1NlbmQpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7IC8vIE5vIGFsZXJ0cyBmb3IgaGVhbHRoeSBzeXN0ZW1cclxuXHJcbiAgICBleHBlY3QoY29uc29sZVNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ1N0YXJ0aW5nIHN5c3RlbSBoZWFsdGggY2hlY2suLi4nKTtcclxuICAgIGV4cGVjdChjb25zb2xlU3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcclxuICAgICAgJ0hlYWx0aCBjaGVjayBjb21wbGV0ZWQ6JyxcclxuICAgICAgZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJ1wib3ZlcmFsbFN0YXR1c1wiOlwiaGVhbHRoeVwiJylcclxuICAgICk7XHJcblxyXG4gICAgY29uc29sZVNweS5tb2NrUmVzdG9yZSgpO1xyXG4gIH0pO1xyXG5cclxuICBpdCgnc2hvdWxkIGRldGVjdCB1bmhlYWx0aHkgRHluYW1vREIgYW5kIHNlbmQgYWxlcnQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICBwcm9jZXNzLmVudi5BTEVSVF9UT1BJQ19BUk4gPSAnYXJuOmF3czpzbnM6dXMtZWFzdC0xOjEyMzQ1Njc4OTAxMjp0ZXN0LWFsZXJ0cyc7XHJcblxyXG4gICAgLy8gTW9jayBEeW5hbW9EQiBmYWlsdXJlXHJcbiAgICBtb2NrRHluYW1vU2VuZC5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ0R5bmFtb0RCIGNvbm5lY3Rpb24gZmFpbGVkJykpO1xyXG5cclxuICAgIC8vIE1vY2sgb3RoZXIgc2VydmljZXMgYXMgaGVhbHRoeVxyXG4gICAgbW9ja1MzU2VuZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSk7XHJcbiAgICBtb2NrU1FTU2VuZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgIEF0dHJpYnV0ZXM6IHtcclxuICAgICAgICBBcHByb3hpbWF0ZU51bWJlck9mTWVzc2FnZXM6ICcwJyxcclxuICAgICAgICBBcHByb3hpbWF0ZU51bWJlck9mTWVzc2FnZXNOb3RWaXNpYmxlOiAnMCcsXHJcbiAgICAgIH0sXHJcbiAgICB9KTtcclxuXHJcbiAgICBtb2NrQ2xvdWRXYXRjaFNlbmQubW9ja1Jlc29sdmVkVmFsdWUoe30pO1xyXG4gICAgbW9ja1NOU1NlbmQubW9ja1Jlc29sdmVkVmFsdWUoe30pO1xyXG5cclxuICAgIGNvbnN0IGNvbnNvbGVTcHkgPSBqZXN0LnNweU9uKGNvbnNvbGUsICdsb2cnKS5tb2NrSW1wbGVtZW50YXRpb24oKTtcclxuXHJcbiAgICBhd2FpdCBoYW5kbGVyKG1vY2tFdmVudCwgbW9ja0NvbnRleHQpO1xyXG5cclxuICAgIGV4cGVjdChtb2NrU05TU2VuZCkudG9IYXZlQmVlbkNhbGxlZCgpOyAvLyBBbGVydCBzaG91bGQgYmUgc2VudFxyXG4gICAgZXhwZWN0KGNvbnNvbGVTcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAnSGVhbHRoIGNoZWNrIGNvbXBsZXRlZDonLFxyXG4gICAgICBleHBlY3Quc3RyaW5nQ29udGFpbmluZygnXCJvdmVyYWxsU3RhdHVzXCI6XCJ1bmhlYWx0aHlcIicpXHJcbiAgICApO1xyXG5cclxuICAgIGNvbnNvbGVTcHkubW9ja1Jlc3RvcmUoKTtcclxuICB9KTtcclxuXHJcbiAgaXQoJ3Nob3VsZCBkZXRlY3QgZGVncmFkZWQgU1FTIHdpdGggbWVzc2FnZSBiYWNrbG9nJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgLy8gTW9jayBzdWNjZXNzZnVsIHJlc3BvbnNlcyBidXQgd2l0aCBoaWdoIG1lc3NhZ2UgY291bnRcclxuICAgIG1vY2tEeW5hbW9TZW5kLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgVGFibGU6IHtcclxuICAgICAgICBUYWJsZVN0YXR1czogJ0FDVElWRScsXHJcbiAgICAgICAgSXRlbUNvdW50OiAxMDAsXHJcbiAgICAgIH0sXHJcbiAgICB9KTtcclxuXHJcbiAgICBtb2NrUzNTZW5kLm1vY2tSZXNvbHZlZFZhbHVlKHt9KTtcclxuXHJcbiAgICBtb2NrU1FTU2VuZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgIEF0dHJpYnV0ZXM6IHtcclxuICAgICAgICBBcHByb3hpbWF0ZU51bWJlck9mTWVzc2FnZXM6ICcxNTAnLCAvLyBIaWdoIG1lc3NhZ2UgY291bnRcclxuICAgICAgICBBcHByb3hpbWF0ZU51bWJlck9mTWVzc2FnZXNOb3RWaXNpYmxlOiAnNTAnLFxyXG4gICAgICB9LFxyXG4gICAgfSk7XHJcblxyXG4gICAgbW9ja0Nsb3VkV2F0Y2hTZW5kLm1vY2tSZXNvbHZlZFZhbHVlKHt9KTtcclxuXHJcbiAgICBjb25zdCBjb25zb2xlU3B5ID0gamVzdC5zcHlPbihjb25zb2xlLCAnbG9nJykubW9ja0ltcGxlbWVudGF0aW9uKCk7XHJcblxyXG4gICAgYXdhaXQgaGFuZGxlcihtb2NrRXZlbnQsIG1vY2tDb250ZXh0KTtcclxuXHJcbiAgICBleHBlY3QobW9ja0Nsb3VkV2F0Y2hTZW5kKS50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICBleHBlY3QoY29uc29sZVNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICdIZWFsdGggY2hlY2sgY29tcGxldGVkOicsXHJcbiAgICAgIGV4cGVjdC5zdHJpbmdDb250YWluaW5nKCdcIm92ZXJhbGxTdGF0dXNcIjpcImRlZ3JhZGVkXCInKVxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zb2xlU3B5Lm1vY2tSZXN0b3JlKCk7XHJcbiAgfSk7XHJcblxyXG4gIGl0KCdzaG91bGQgaGFuZGxlIFMzIGFjY2VzcyBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAvLyBNb2NrIER5bmFtb0RCIGFzIGhlYWx0aHlcclxuICAgIG1vY2tEeW5hbW9TZW5kLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgVGFibGU6IHtcclxuICAgICAgICBUYWJsZVN0YXR1czogJ0FDVElWRScsXHJcbiAgICAgICAgSXRlbUNvdW50OiAxMDAsXHJcbiAgICAgIH0sXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBNb2NrIFMzIGZhaWx1cmVcclxuICAgIG1vY2tTM1NlbmQubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdBY2Nlc3MgRGVuaWVkJykpO1xyXG5cclxuICAgIC8vIE1vY2sgb3RoZXIgc2VydmljZXMgYXMgaGVhbHRoeVxyXG4gICAgbW9ja1NRU1NlbmQubW9ja1Jlc29sdmVkVmFsdWUoe1xyXG4gICAgICBBdHRyaWJ1dGVzOiB7XHJcbiAgICAgICAgQXBwcm94aW1hdGVOdW1iZXJPZk1lc3NhZ2VzOiAnMCcsXHJcbiAgICAgICAgQXBwcm94aW1hdGVOdW1iZXJPZk1lc3NhZ2VzTm90VmlzaWJsZTogJzAnLFxyXG4gICAgICB9LFxyXG4gICAgfSk7XHJcblxyXG4gICAgbW9ja0Nsb3VkV2F0Y2hTZW5kLm1vY2tSZXNvbHZlZFZhbHVlKHt9KTtcclxuXHJcbiAgICBjb25zdCBjb25zb2xlU3B5ID0gamVzdC5zcHlPbihjb25zb2xlLCAnbG9nJykubW9ja0ltcGxlbWVudGF0aW9uKCk7XHJcblxyXG4gICAgYXdhaXQgaGFuZGxlcihtb2NrRXZlbnQsIG1vY2tDb250ZXh0KTtcclxuXHJcbiAgICBleHBlY3QoY29uc29sZVNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgICdIZWFsdGggY2hlY2sgY29tcGxldGVkOicsXHJcbiAgICAgIGV4cGVjdC5zdHJpbmdDb250YWluaW5nKCdcIm92ZXJhbGxTdGF0dXNcIjpcInVuaGVhbHRoeVwiJylcclxuICAgICk7XHJcblxyXG4gICAgY29uc29sZVNweS5tb2NrUmVzdG9yZSgpO1xyXG4gIH0pO1xyXG5cclxuICBpdCgnc2hvdWxkIHNlbmQgY3JpdGljYWwgYWxlcnQgd2hlbiBoZWFsdGggY2hlY2sgc3lzdGVtIGZhaWxzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgcHJvY2Vzcy5lbnYuQUxFUlRfVE9QSUNfQVJOID0gJ2Fybjphd3M6c25zOnVzLWVhc3QtMToxMjM0NTY3ODkwMTI6dGVzdC1hbGVydHMnO1xyXG5cclxuICAgIC8vIE1vY2sgYWxsIHNlcnZpY2VzIHRvIHRocm93IGVycm9yc1xyXG4gICAgbW9ja0R5bmFtb1NlbmQubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdTeXN0ZW0gZmFpbHVyZScpKTtcclxuICAgIG1vY2tTM1NlbmQubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdTeXN0ZW0gZmFpbHVyZScpKTtcclxuICAgIG1vY2tTUVNTZW5kLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignU3lzdGVtIGZhaWx1cmUnKSk7XHJcbiAgICBtb2NrQ2xvdWRXYXRjaFNlbmQubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdDbG91ZFdhdGNoIGZhaWx1cmUnKSk7XHJcbiAgICBtb2NrU05TU2VuZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSk7XHJcblxyXG4gICAgY29uc3QgY29uc29sZUVycm9yU3B5ID0gamVzdC5zcHlPbihjb25zb2xlLCAnZXJyb3InKS5tb2NrSW1wbGVtZW50YXRpb24oKTtcclxuXHJcbiAgICBhd2FpdCBoYW5kbGVyKG1vY2tFdmVudCwgbW9ja0NvbnRleHQpO1xyXG5cclxuICAgIGV4cGVjdChtb2NrU05TU2VuZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXHJcbiAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcclxuICAgICAgICBUb3BpY0FybjogJ2Fybjphd3M6c25zOnVzLWVhc3QtMToxMjM0NTY3ODkwMTI6dGVzdC1hbGVydHMnLFxyXG4gICAgICAgIFN1YmplY3Q6ICdDUklUSUNBTDogSGVhbHRoIENoZWNrIFN5c3RlbSBGYWlsdXJlJyxcclxuICAgICAgfSlcclxuICAgICk7XHJcblxyXG4gICAgY29uc29sZUVycm9yU3B5Lm1vY2tSZXN0b3JlKCk7XHJcbiAgfSk7XHJcblxyXG4gIGl0KCdzaG91bGQgaGFuZGxlIG1pc3NpbmcgZW52aXJvbm1lbnQgdmFyaWFibGVzIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAvLyBSZW1vdmUgc29tZSBlbnZpcm9ubWVudCB2YXJpYWJsZXNcclxuICAgIGRlbGV0ZSBwcm9jZXNzLmVudi5DT05URU5UX1RBQkxFX05BTUU7XHJcbiAgICBkZWxldGUgcHJvY2Vzcy5lbnYuQVVESU9fQlVDS0VUX05BTUU7XHJcblxyXG4gICAgbW9ja0Nsb3VkV2F0Y2hTZW5kLm1vY2tSZXNvbHZlZFZhbHVlKHt9KTtcclxuXHJcbiAgICBjb25zdCBjb25zb2xlU3B5ID0gamVzdC5zcHlPbihjb25zb2xlLCAnbG9nJykubW9ja0ltcGxlbWVudGF0aW9uKCk7XHJcblxyXG4gICAgYXdhaXQgaGFuZGxlcihtb2NrRXZlbnQsIG1vY2tDb250ZXh0KTtcclxuXHJcbiAgICAvLyBTaG91bGQgc3RpbGwgY29tcGxldGUgYnV0IHdpdGggZmV3ZXIgY2hlY2tzXHJcbiAgICBleHBlY3QoY29uc29sZVNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ1N0YXJ0aW5nIHN5c3RlbSBoZWFsdGggY2hlY2suLi4nKTtcclxuXHJcbiAgICBjb25zb2xlU3B5Lm1vY2tSZXN0b3JlKCk7XHJcbiAgfSk7XHJcblxyXG4gIGl0KCdzaG91bGQgbm90IHNlbmQgYWxlcnRzIHdoZW4gYWxlcnQgdG9waWMgaXMgbm90IGNvbmZpZ3VyZWQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAvLyBEb24ndCBzZXQgQUxFUlRfVE9QSUNfQVJOXHJcblxyXG4gICAgLy8gTW9jayBEeW5hbW9EQiBmYWlsdXJlXHJcbiAgICBtb2NrRHluYW1vU2VuZC5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ0R5bmFtb0RCIGNvbm5lY3Rpb24gZmFpbGVkJykpO1xyXG4gICAgbW9ja1MzU2VuZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSk7XHJcbiAgICBtb2NrU1FTU2VuZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XHJcbiAgICAgIEF0dHJpYnV0ZXM6IHtcclxuICAgICAgICBBcHByb3hpbWF0ZU51bWJlck9mTWVzc2FnZXM6ICcwJyxcclxuICAgICAgICBBcHByb3hpbWF0ZU51bWJlck9mTWVzc2FnZXNOb3RWaXNpYmxlOiAnMCcsXHJcbiAgICAgIH0sXHJcbiAgICB9KTtcclxuICAgIG1vY2tDbG91ZFdhdGNoU2VuZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSk7XHJcblxyXG4gICAgY29uc3QgY29uc29sZVdhcm5TcHkgPSBqZXN0LnNweU9uKGNvbnNvbGUsICd3YXJuJykubW9ja0ltcGxlbWVudGF0aW9uKCk7XHJcbiAgICBjb25zdCBjb25zb2xlU3B5ID0gamVzdC5zcHlPbihjb25zb2xlLCAnbG9nJykubW9ja0ltcGxlbWVudGF0aW9uKCk7XHJcblxyXG4gICAgYXdhaXQgaGFuZGxlcihtb2NrRXZlbnQsIG1vY2tDb250ZXh0KTtcclxuXHJcbiAgICBleHBlY3QobW9ja1NOU1NlbmQpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XHJcbiAgICBleHBlY3QoY29uc29sZVdhcm5TcHkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICAnQWxlcnQgdG9waWMgQVJOIG5vdCBjb25maWd1cmVkLCBza2lwcGluZyBoZWFsdGggYWxlcnQnXHJcbiAgICApO1xyXG5cclxuICAgIGNvbnNvbGVXYXJuU3B5Lm1vY2tSZXN0b3JlKCk7XHJcbiAgICBjb25zb2xlU3B5Lm1vY2tSZXN0b3JlKCk7XHJcbiAgfSk7XHJcblxyXG4gIGl0KCdzaG91bGQgaW5jbHVkZSBzZXJ2aWNlIHJlc3BvbnNlIHRpbWVzIGluIG1ldHJpY3MnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAvLyBNb2NrIHN1Y2Nlc3NmdWwgcmVzcG9uc2VzIHdpdGggc29tZSBkZWxheVxyXG4gICAgbW9ja0R5bmFtb1NlbmQubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IFxyXG4gICAgICBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQoKCkgPT4gcmVzb2x2ZSh7XHJcbiAgICAgICAgVGFibGU6IHsgVGFibGVTdGF0dXM6ICdBQ1RJVkUnLCBJdGVtQ291bnQ6IDEwMCB9XHJcbiAgICAgIH0pLCAxMDApKVxyXG4gICAgKTtcclxuXHJcbiAgICBtb2NrUzNTZW5kLm1vY2tSZXNvbHZlZFZhbHVlKHt9KTtcclxuICAgIG1vY2tTUVNTZW5kLm1vY2tSZXNvbHZlZFZhbHVlKHtcclxuICAgICAgQXR0cmlidXRlczoge1xyXG4gICAgICAgIEFwcHJveGltYXRlTnVtYmVyT2ZNZXNzYWdlczogJzAnLFxyXG4gICAgICAgIEFwcHJveGltYXRlTnVtYmVyT2ZNZXNzYWdlc05vdFZpc2libGU6ICcwJyxcclxuICAgICAgfSxcclxuICAgIH0pO1xyXG5cclxuICAgIG1vY2tDbG91ZFdhdGNoU2VuZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7fSk7XHJcblxyXG4gICAgY29uc3QgY29uc29sZVNweSA9IGplc3Quc3B5T24oY29uc29sZSwgJ2xvZycpLm1vY2tJbXBsZW1lbnRhdGlvbigpO1xyXG5cclxuICAgIGF3YWl0IGhhbmRsZXIobW9ja0V2ZW50LCBtb2NrQ29udGV4dCk7XHJcblxyXG4gICAgLy8gVmVyaWZ5IHRoYXQgQ2xvdWRXYXRjaCBtZXRyaWNzIGluY2x1ZGUgcmVzcG9uc2UgdGltZXNcclxuICAgIGV4cGVjdChtb2NrQ2xvdWRXYXRjaFNlbmQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxyXG4gICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XHJcbiAgICAgICAgTmFtZXNwYWNlOiAnQXV0b21hdGVkQmxvZ1Bvc3Rlci9IZWFsdGhDaGVjaycsXHJcbiAgICAgICAgTWV0cmljRGF0YTogZXhwZWN0LmFycmF5Q29udGFpbmluZyhbXHJcbiAgICAgICAgICBleHBlY3Qub2JqZWN0Q29udGFpbmluZyh7XHJcbiAgICAgICAgICAgIE1ldHJpY05hbWU6ICdTZXJ2aWNlUmVzcG9uc2VUaW1lJyxcclxuICAgICAgICAgICAgRGltZW5zaW9uczogZXhwZWN0LmFycmF5Q29udGFpbmluZyhbXHJcbiAgICAgICAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xyXG4gICAgICAgICAgICAgICAgTmFtZTogJ1NlcnZpY2UnLFxyXG4gICAgICAgICAgICAgICAgVmFsdWU6IGV4cGVjdC5hbnkoU3RyaW5nKSxcclxuICAgICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgXSksXHJcbiAgICAgICAgICB9KSxcclxuICAgICAgICBdKSxcclxuICAgICAgfSlcclxuICAgICk7XHJcblxyXG4gICAgY29uc29sZVNweS5tb2NrUmVzdG9yZSgpO1xyXG4gIH0pO1xyXG59KTsiXX0=